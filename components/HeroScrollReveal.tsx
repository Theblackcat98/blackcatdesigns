'use client'

import { useRef } from 'react'
import gsap from 'gsap'
import { useGSAP } from '@gsap/react'
import { ScrollTrigger } from 'gsap/ScrollTrigger'

gsap.registerPlugin(ScrollTrigger)

interface HeroScrollRevealProps {
    children: React.ReactNode
}

export default function HeroScrollReveal({ children }: HeroScrollRevealProps) {
    const containerRef = useRef<HTMLDivElement>(null)
    const svgRef = useRef<SVGSVGElement>(null)
    const contentRef = useRef<HTMLDivElement>(null)
    const logoPathRef = useRef<SVGPathElement>(null)

    useGSAP(() => {
        if (!containerRef.current || !logoPathRef.current) return

        const heightRatio = window.innerWidth / window.innerHeight

        const tl = gsap.timeline({
            scrollTrigger: {
                trigger: containerRef.current,
                start: 'top top',
                end: '+=200%',
                pin: true,
                scrub: true,
                invalidateOnRefresh: true,
            },
        })

        tl.fromTo(
            [svgRef.current, contentRef.current],
            { autoAlpha: 0 },
            { autoAlpha: 1 }
        )
            .fromTo(
                logoPathRef.current,
                {
                    scaleX: 0.25,
                    scaleY: 0.25 * heightRatio,
                    x: 0,
                    transformOrigin: 'center center',
                },
                {
                    scaleX: 25, // Increased scale to ensure full coverage
                    scaleY: 25 * heightRatio,
                    x: -1.45,
                    transformOrigin: 'center center',
                    duration: 1,
                    ease: 'power2.in',
                }
            )
            .to({}, { duration: 0.25 }) // Pause at the end

    }, { scope: containerRef })

    return (
        <>
            <section ref={containerRef} className="relative w-full h-screen min-h-[100svh] flex items-center justify-center overflow-hidden z-10 bg-[var(--bg-primary)]">
                <div className="absolute inset-0 w-full h-full flex justify-center items-center overflow-hidden" style={{ clipPath: 'url(#clip-path1)', backgroundColor: 'var(--bg-primary)' }}>
                    {/* Background SVG with Swirl */}
                    <svg ref={svgRef} className="absolute inset-0 w-full h-full z-0 block opacity-0" viewBox="0 0 1200 900" preserveAspectRatio="xMidYMid slice" xmlns="http://www.w3.org/2000/svg">
                        <defs>
                            <radialGradient id="swirlGradient" cx="50%" cy="50%" r="80%">
                                <stop offset="0%" stopColor="var(--accent-tertiary)" />
                                <stop offset="60%" stopColor="var(--accent-secondary)" />
                                <stop offset="100%" stopColor="var(--accent)" />
                            </radialGradient>
                            <filter id="swirl" x="0" y="0">
                                <feTurbulence type="turbulence" baseFrequency="0.012 0.018" numOctaves="2" seed="8" result="turb" />
                                <feDisplacementMap in2="turb" in="SourceGraphic" scale="120" xChannelSelector="R" yChannelSelector="G" />
                            </filter>
                        </defs>
                        <circle cx="600" cy="450" r="800" fill="url(#swirlGradient)" filter="url(#swirl)" />
                    </svg>

                    {/* Content */}
                    <div ref={contentRef} className="relative z-10 opacity-0 w-full h-full flex flex-col justify-center items-center">
                        {children}
                    </div>
                </div>
            </section>

            {/* Hidden Clip Path SVG */}
            <svg xmlns="http://www.w3.org/2000/svg" width="0" height="0" id="clipContainer" className="absolute top-0 left-0 opacity-0 pointer-events-none z-0">
                <clipPath id="clip-path1" clipPathUnits="objectBoundingBox">
                    <path
                        ref={logoPathRef}
                        id="logoPath"
                        d="m 0.40962096,0.31446904 c -0.0340042,0 -0.0633024,0.0107274 -0.0847146,0.0310409 -0.0202557,0.0192228 -0.0316925,0.0458281 -0.0321986,0.0749041 -8.7256e-4,0.0501654 0.0271691,0.0820598 0.0584361,0.11294131 0.0242105,0.0251631 0.028648,0.0376104 0.0284055,0.0518038 -2.8463e-4,0.0164246 -0.008028,0.0258549 -0.0212273,0.0258549 -0.005455,0 -0.009815,-0.001705 -0.0129572,-0.00507 -0.004887,-0.005192 -0.007055,-0.0145795 -0.006265,-0.0271506 2.8463e-4,-0.001623 -1.8409e-4,-0.003344 -0.001299,-0.004743 -0.001298,-0.001623 -0.003224,-0.002575 -0.00517,-0.002575 h -0.0714751 c -0.003628,0 -0.006629,0.002938 -0.006711,0.006548 -0.001683,0.0348347 0.006344,0.0618233 0.0238627,0.0802157 0.0172567,0.0181065 0.04321,0.0272918 0.0771725,0.0272918 0.0665082,0 0.11022442,-0.0419924 0.11136009,-0.10695839 6.8909e-4,-0.0401676 -0.0138094,-0.0705611 -0.050003,-0.10486893 -0.0274938,-0.0269476 -0.0371439,-0.0426227 -0.0368387,-0.0598793 2.6344e-4,-0.0154705 0.009465,-0.0243333 0.0237402,-0.0243333 0.0142754,0 0.0212524,0.00992 0.0212524,0.0302974 0,0.004522 0.003789,0.008232 0.008311,0.008232 h 0.0691031 c 0.00363,0 0.006651,-0.00296 0.006711,-0.006569 h 2.201e-5 c 8.509e-4,-0.0334986 -0.006833,-0.0596777 -0.0227901,-0.0778051 -0.0168503,-0.01912 -0.0426633,-0.0289348 -0.076727,-0.0291773 z m -0.24098579,0.001177 c -0.10241581,0 -0.15558343,0.10454407 -0.16685659,0.20815659 -0.00624375,0.0551932 0.0040747,0.10099728 0.02901415,0.12897941 0.01887752,0.0211681 0.04112246,0.0318973 0.07413236,0.0318973 0.0367204,0 0.0642179,-0.008234 0.0865217,-0.0258957 0.0262184,-0.0207425 0.0460656,-0.0552941 0.0607264,-0.10555912 3.2471e-4,-0.001136 0.001379,-0.001927 0.002554,-0.001927 h 0.0158781 c 0.003731,0 0.006955,-0.002393 0.007664,-0.005656 l 0.013158,-0.0577084 v -1.603e-4 h -1.88e-5 c 6.104e-5,-0.003365 -0.002253,-0.006448 -0.005537,-0.006874 -2.8463e-4,-6.103e-5 -5.8761e-4,-6.28e-5 -8.9109e-4,-6.28e-5 H 0.15855802 v 1.4401e-4 c -0.003266,4.0487e-4 -0.005921,0.002636 -0.006569,0.005593 l -0.0131831,0.0578124 c -3.6275e-4,0.001581 4.164e-5,0.003182 0.001076,0.00448 0.001237,0.001542 0.003285,0.002494 0.005353,0.002494 h 0.0192633 c 0.001115,0 0.002575,1.61e-4 0.003102,8.5016e-4 5.0744e-4,6.698e-4 4.6737e-4,0.002171 -5.96e-5,0.004097 -0.003753,0.0138898 -0.0126538,0.0291138 -0.0237246,0.0379147 -0.0110708,0.0088 -0.0293601,0.0140722 -0.0421754,0.006124 -0.01445693,-0.008962 -0.01691219,-0.030597 -0.01750012,-0.0459872 -0.0012563,-0.0330501 0.0051326,-0.0662222 0.01770404,-0.0967777 0.009003,-0.0218797 0.0259732,-0.0613383 0.0547248,-0.0613383 0.0163026,0 0.0245167,0.0136264 0.0251239,0.0415667 -4.016e-5,0.002657 0.002331,0.00507 0.004989,0.00507 h 0.0750234 c 0.003628,0 0.00665,-0.002963 0.006711,-0.006632 -4.176e-5,-0.0404091 -0.009185,-0.0712883 -0.027171,-0.0917882 -0.0170123,-0.0193826 -0.0414655,-0.0290969 -0.0726105,-0.0288125 z m 0.70710122,0.005534 -5.96e-5,4.079e-5 h -0.0567768 c -0.003003,0 -0.00637,0.001602 -0.007158,0.005211 0,0 -0.0790141,0.34664907 -0.0790141,0.34668925 -3.5327e-4,0.001586 3.914e-5,0.003244 0.001073,0.004498 0.001236,0.00154 0.003282,0.002497 0.005351,0.002497 h 0.07097 c 0.003814,0 0.006424,-0.001889 0.007135,-0.005173 0,0 0.008598,-0.0391748 0.008618,-0.0392952 6.046e-4,-0.003062 -4.484e-4,-0.005433 -0.003166,-0.006874 -0.001274,-6.6845e-4 -0.002556,-0.001337 -0.003814,-0.002005 l -0.0123075,-0.006469 -0.0122481,-0.006448 c -0.001583,-8.3241e-4 -0.003159,-0.001666 -0.004726,-0.002497 -7.8761e-4,-4.008e-4 -0.001282,-0.001218 -0.001258,-0.002105 2.881e-5,-0.001326 0.001104,-0.002387 0.002433,-0.002394 l 0.0388934,1.8206e-4 c 0.0116381,5.944e-5 0.0232762,-7.7055e-4 0.0347113,-0.002899 0.0805481,-0.0150248 0.1340362,-0.0802148 0.1355767,-0.16890457 0.00132,-0.0756915 -0.0404903,-0.11405507 -0.12423209,-0.11405509 z m -0.26540062,4.079e-5 c -0.003591,0 -0.005166,0.003123 -0.006201,0.005192 L 0.44928216,0.67119464 v 5.961e-5 c 0,0 -3.871e-5,6.072e-5 -5.96e-5,8.151e-5 -0.001724,0.004238 0.00154,0.008781 0.006083,0.008781 h 0.0747598 c 0.004039,0 0.00671,-0.001237 0.008029,-0.003812 l 0.0148426,-0.0360542 c 0.00183,-0.004806 0.00217,-0.005248 0.007359,-0.005248 h 0.071434 c 0.004965,0 0.005065,9.986e-5 0.004989,0.005008 l -0.001598,0.0335163 c -7.196e-5,0.003621 0.002849,0.006596 0.00647,0.006591 h 0.075532 c 0.001923,0 0.003729,-8.1309e-4 0.004926,-0.002253 0.001065,-0.001264 0.001537,-0.002928 0.001274,-0.004562 l 4.484e-4,-0.34549078 c 7.475e-5,-0.003621 -0.002849,-0.006597 -0.00647,-0.006592 z m 0.22770544,0.0770532 h 0.0519075 c 0.0161615,5.0609e-4 0.0251634,0.0151053 0.024738,0.0400451 -7.5e-4,0.0431892 -0.0210679,0.0876955 -0.0583358,0.0892167 h -0.001522 c -0.003406,0 -0.004015,-3.8585e-4 -0.004115,-5.0813e-4 -6.108e-5,-8.015e-5 0.0224253,-0.0998427 0.0224446,-0.099984 5.7064e-4,-0.00288 5.4345e-4,-0.004542 -0.00122,-0.005516 -0.002247,-0.001256 -0.0350789,-0.018755 -0.0350789,-0.018755 -7.7988e-4,-4.1778e-4 -0.001258,-0.001241 -0.001236,-0.002127 2.873e-5,-0.001314 0.001097,-0.002365 0.002409,-0.002372 z m -0.19310047,0.0160632 c 4.1304e-4,-8.899e-5 7.5704e-4,2.1602e-4 9.1888e-4,8.8491e-4 2.8462e-4,0.001116 -0.006147,0.13751613 -0.006147,0.13751613 -5.0739e-4,0.005109 -7.2862e-4,0.005312 -0.005714,0.005738 l -0.0429472,-5.0539e-4 h -1.0053e-4 l 4.076e-5,-2.201e-5 c -6.8908e-4,0 -0.001236,-1.944e-5 -0.001683,-5.958e-5 -0.001119,-1.0395e-4 -0.001869,-0.001188 -0.001583,-0.002272 1.427e-4,-5.0745e-4 3.4578e-4,-0.001176 6.4947e-4,-0.002008 l 0.0535724,-0.13392349 c 4.8368e-4,-0.00132 0.001043,-0.002614 0.00166,-0.003874 4.3611e-4,-9.0266e-4 9.1888e-4,-0.001386 0.001329,-0.001475 z"
                    />
                </clipPath>
            </svg>
        </>
    )
}
